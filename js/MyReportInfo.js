let rowSize=27,accountIndex=2,bookIndex=1,billMonthIndex=3,billYearIndex=4,billTotalAmountIndex=24,allRows=new Array,customerBills={},rebAllRows=new Array,rebBills={},myLength=0,rebLength=0,iframe=document.getElementById("myReportIframe");function fillAndSortArray(){let e=new Promise(function(e,t){let l=new Array;for(var n=(iframe.contentDocument||iframe.contentWindow.document).getElementsByTagName("span"),r=0;r<n.length;r++)l.push(n[r]);l.sort((e,t)=>{var l=e.style.top.replace("pt",""),n=e.style.left.replace("pt",""),e=t.style.top.replace("pt",""),t=t.style.left.replace("pt","");return parseFloat(l)!=parseFloat(e)?parseFloat(l)-parseFloat(e):parseFloat(n)-parseFloat(t)}),e(l)});e.then(filterElements)}function filterElements(e){for(var t=new Array,l=-1,n=0;n<e.length;n++)0<n&&e[n].style.top!=e[n-1].style.top&&(t.length==rowSize&&(l++,allRows[l]=new Array,allRows[l]=t.slice()),t.length=0),t.push(e[n]);t.length==rowSize&&(l++,allRows[l]=new Array,allRows[l]=t.slice()),t.length=0,buildTheObj()}function buildTheObj(){for(var e,t,l={},n={},r=0;r<allRows.length;r++){var o=(e=allRows[r][accountIndex].innerText)+(t=allRows[r][bookIndex].innerText);0==customerBills.hasOwnProperty(o)&&(l.account=e,l.book=t,l.info=new Array,l.total=0,customerBills[o]=l,l={},myLength++),n.billMonth=allRows[r][billMonthIndex].innerText,n.billYear=allRows[r][billYearIndex].innerText,n.billTotalAmount=allRows[r][billTotalAmountIndex].innerText,customerBills[o].info.push(n),customerBills[o].total=parseInt(customerBills[o].total)+parseInt(allRows[r][billTotalAmountIndex].innerText),n={}}$("#excelFile").prop("disabled",!1)}function sheetJsParse(e){var t=new FileReader;t.onload=function(e){var e=e.target.result,t=XLSX.read(e,{type:"binary"});t.SheetNames.forEach(function(e){filterExcelData(XLSX.utils.sheet_to_row_object_array(t.Sheets[e]))})},t.onerror=function(e){console.log(e)},t.readAsBinaryString(e)}function filterExcelData(o){var a=-1;let e=new Promise(function(e,t){for(var l=new Array,n=0;n<o.length;n++){for(var r in o[n])l.push(o[n][r]);10==l.length&&(a++,rebAllRows[a]=new Array,rebAllRows[a]=l.slice()),l.length=0}e()});e.then(buildRebObject)}function buildRebObject(){for(var e,t={},l={},n=0;n<rebAllRows.length;n++){var r=(e=(r=rebAllRows[n][1]).substring(r.length-4))+(o=r.substring(r.length-7,r.length-4));0==rebBills.hasOwnProperty(r)&&(t.account=e,t.book=o,t.info=new Array,t.total=0,rebBills[r]=t,t={},rebLength++);var o=rebAllRows[n][2];l.billMonth=o.substring(o.length-4,o.length-2),l.billYear=o.substring(o.length-2),l.billTotalAmount=rebAllRows[n][7],rebBills[r].info.push(l),rebBills[r].total=parseInt(rebBills[r].total)+parseInt(rebAllRows[n][7]),l={}}$("#matchButton").prop("disabled",!1)}function matchObject(){$("#matchButton").prop("disabled",!0);var e,t=0,l=0,n=0,r=0;for(e in customerBills){n++;var o,a=customerBills[e];1==rebBills.hasOwnProperty(e)?(o=rebBills[e],r++,a.total!=o.total?l++:t++,printDouble(e)):(l++,printSingle(e,"My Report"))}if(myLength<rebLength)for(var i in rebBills)0==customerBills.hasOwnProperty(x)&&(l++,printSingle(x,"REB Report"),r++);document.getElementById("htmlItem").innerText=n,document.getElementById("excelItem").innerText=r,document.getElementById("match").innerText=t,document.getElementById("diff").innerText=l}function printDouble(e){var t=customerBills[e],l=rebBills[e],n="",r=preparePrint("My Report",t.info,t.total),e=preparePrint("REB Report",l.info,l.total);t.total!=l.total&&(n='style="background: #F00"');n="<div "+n+' class="listCon">';n+='<h5 style="margin: 3px;">Book:'+t.book+" Account:"+t.account+"</h5>"+r+e+"</div>",$("#contentWrapper").append(n)}function printSingle(e,t){var l=("My Report"==t?customerBills:rebBills)[e],e='<div style="background: #F00" class="listCon">';e+='<h5 style="margin: 3px;">Book:'+l.book+" Account:"+l.account+"</h5>"+preparePrint(t,l.info,l.total)+"</div>",$("#contentWrapper").append(e)}function preparePrint(e,t,l){var n="";n+='<div class="parentRow"><div class="type">'+e+'</div><div class="info">';for(var r=0;r<t.length;r++)n+='<div style="display: flex;justify-content: space-between;">',n+="<div>Month:"+t[r].billMonth+"</div>",n+="<div>Year:"+t[r].billYear+"</div>",n+="<div>Amount:"+t[r].billTotalAmount+"</div></div>";return n+='<div style="text-align: right;">Total: '+l+"</div></div></div>"}